<!DOCTYPE html>
<html lang="en">
<head>
    <title><%= title %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="referrer" content="always">
    <meta name="description" content="TailwindCSS Ecommerce Template">
    <link rel="stylesheet" href="/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const searchInput = document.querySelector('input[name="search"]');
            const resultsDropdown = document.getElementById("results-dropdown");

            searchInput.addEventListener("input", function() {
                const query = searchInput.value;
                if (query.length > 2) { // Only search if query length is greater than 2
                    fetch(`/search?search=${query}`)
                        .then(response => response.json())
                        .then(data => {
                            resultsDropdown.innerHTML = "";
                            data.products.forEach(product => {
                                const productElement = document.createElement("div");
                                productElement.classList.add("bg-white", "shadow-md", "p-2", "hover:bg-gray-100", "cursor-pointer");
                                productElement.innerHTML = `
                                    <a href="/products/${product.id}" class="flex items-center">
                                        <img src="${product.imageurl}" alt="${product.name}" class="w-10 h-10 object-cover mr-2" />
                                        <div>
                                            <p class="text-gray-800">${product.name}</p>
                                            <p class="text-gray-500 text-sm">${product.price}</p>
                                        </div>
                                    </a>
                                `;
                                resultsDropdown.appendChild(productElement);
                            });
                            resultsDropdown.classList.remove("hidden");
                        });
                } else {
                    resultsDropdown.innerHTML = ""; // Clear results if query is too short
                    resultsDropdown.classList.add("hidden");
                }
            });

            document.addEventListener("click", function(event) {
                if (!searchInput.contains(event.target) && !resultsDropdown.contains(event.target)) {
                    resultsDropdown.classList.add("hidden");
                }
            });
        });
    </script>
</head>
<body>
    <div x-data="{ cartOpen: false , isOpen: false }">
        <!-- #region Header -->
        <header class="bg-slate-900">
            <div class="container mx-auto px-6 py-3">
                <div class="flex items-center justify-between">
                    <div class="hidden w-full text-gray-600 md:flex md:items-center">
                        <i class="gg-profile"></i>
                    </div>
                    <div class="w-full text-blue-300 md:text-center font-mono text-4xl font-semibold uppercase tracking-widest">
                        E-Commerce
                    </div>
                    <div class="flex items-center justify-end w-full">
                        <button @click="cartOpen = !cartOpen" class="text-gray-600 focus:outline-none mx-4 sm:mx-0">
                            <i class="gg-shopping-cart"></i>
                        </button>

                        <div class="flex sm:hidden">
                            <button @click="isOpen = !isOpen" type="button"
                                class="text-gray-600 hover:text-gray-500 focus:outline-none focus:text-gray-500"
                                aria-label="toggle menu">
                                <i class="gg-menu-grid-r"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <nav :class="isOpen ? '' : 'hidden'" class="sm:flex sm:justify-center sm:items-center mt-4">
                    <div class="flex flex-col sm:flex-row">
                        <a class="mt-3 text-white hover:underline sm:mx-3 sm:mt-0" href="/">Home</a>
                        <a class="mt-3 text-white hover:underline sm:mx-3 sm:mt-0" href="/category">Category</a>
                        <a class="mt-3 text-white hover:underline sm:mx-3 sm:mt-0" href="/product">Product</a>
                        <a class="mt-3 text-white hover:underline sm:mx-3 sm:mt-0" href="/cart">Cart</a>
                        <a class="mt-3 text-white hover:underline sm:mx-3 sm:mt-0" href="/contact">Contact</a>
                    </div>
                </nav>
                <!-- #region Search -->
                <div class="relative mt-6 max-w-lg mx-auto col-span-4">
                    <form method="GET" action="/search">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center">
                            <i class="gg-search"></i>
                        </span>
                        <input
                            class="bg-gray-100 h-8 mb-2 rounded-xl pl-10 block w-full border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                            type="text" name="search" placeholder="Search" value="<%= search %>" />
                    </form>
                    <div id="results-dropdown" class="absolute bg-white shadow-lg w-full mt-1 hidden"></div>
                </div>
                <!-- #endregion Search -->
            </div>
        </header>
        <!-- #endregion Header -->

        <main class="my-8">
            <!-- Page-specific content here -->
            <%- body %>
        </main>

        <!-- #region Footer-->
        <!-- Footer code here -->
        <!-- #endregion Footer -->
    </div>
</body>
</html>